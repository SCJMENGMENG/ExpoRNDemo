import MultiplePolygonsMapCanvas, { PolygonData, ZoneData } from '@/components/skiaDrawMap/MultiplePolygonsCanvasMap';
import React, { useEffect } from 'react';
import {
  Text,
  TouchableOpacity,
  useWindowDimensions,
  View,
} from 'react-native';
import eventBus from '../utils/EventBus';

const skiaDrawMapPage = () => {
  const { width, height } = useWindowDimensions();

  const [activeTabIndex, setActiveTabIndex] = React.useState(0);

  useEffect(() => {
    eventBus.emit('changePage', false); // 非首页，禁用边缘手势
  }, []);

  const data: PolygonData[] = [
    {
      type: 0, data: {
        hashId: 'zone1', name: 'Zone 1', points: [
          { x: 7.450745105743408, y: -1.0735529661178589 },
          { x: 7.347474098205566, y: -0.9654830098152161 },
          { x: 7.157138824462891, y: -0.7697229981422424 },
          { x: 6.803013801574707, y: -0.544169008731842 },
          { x: 6.522429943084717, y: -0.4775170087814331 },
          { x: 6.25832986831665, y: -0.4885199964046478 },
          { x: 4.915526866912842, y: -0.9700800180435181 },
          { x: 3.890666961669922, y: -1.681838035583496 },
          { x: 3.76181697845459, y: -1.7806220054626465 },
          { x: 3.6954360008239746, y: -1.9302489757537842 },
          { x: 3.737696886062622, y: -2.1859920024871826 },
          { x: 3.9137699604034424, y: -2.5764219760894775 },
          { x: 3.9560930728912354, y: -2.869839906692505 },
          { x: 3.8869760036468506, y: -3.248724937438965 },
          { x: 3.7362170219421387, y: -3.516472101211548 },
          { x: 3.3162050247192383, y: -3.925143003463745 },
          { x: 3.0650930404663086, y: -4.288022994995117 },
          { x: 2.9518699645996094, y: -4.702391147613525 },
          { x: 2.9633278846740723, y: -4.998751163482666 },
          { x: 3.049428939819336, y: -5.285757064819336 },
          { x: 3.2898499965667725, y: -5.636868953704834 },
          { x: 3.6039140224456787, y: -5.862598896026611 },
          { x: 3.8984649181365967, y: -5.963068962097168 },
          { x: 4.291920185089111, y: -5.972415924072266 },
          { x: 5.39168119430542, y: -5.534857749938965 },
          { x: 5.63615083694458, y: -5.395761966705322 },
          { x: 6.599853038787842, y: -4.5049638748168945 },
          { x: 8.04559326171875, y: -3.456624984741211 },
          { x: 8.20444107055664, y: -3.3294949531555176 },
          { x: 8.365509986877441, y: -3.1388680934906006 },
          { x: 8.478252410888672, y: -2.914341926574707 },
          { x: 8.534815788269043, y: -2.6035399436950684 },
          { x: 8.455713272094727, y: -2.2280290126800537 },
          { x: 8.260555267333984, y: -1.922516942024231 },
          { x: 7.450745105743408, y: -1.0735529661178589 }
        ]
      }
    },
    {
      type: 0, data: {
        hashId: 'zone2', name: 'Zone 2', points: [
          { x: 10.233124732971191, y: -7.452577114105225 },
          { x: 10.463072776794434, y: -7.402925968170166 },
          { x: 11.2451171875, y: -6.988377094268799 },
          { x: 12.492106437683105, y: -6.45603084564209 },
          { x: 12.692422866821289, y: -6.340649127960205 },
          { x: 12.87778377532959, y: -6.1776509284973145 },
          { x: 13.021584510803223, y: -5.977579116821289 },
          { x: 13.110516548156738, y: -5.7647929191589355 },
          { x: 13.142960548400879, y: -5.24717378616333 },
          { x: 13.060415267944336, y: -4.01442289352417 },
          { x: 13.012816429138184, y: -3.7932488918304443 },
          { x: 12.905471801757812, y: -3.568924903869629 },
          { x: 12.757152557373047, y: -3.3924660682678223 },
          { x: 12.559151649475098, y: -3.2516579627990723 },
          { x: 12.173935890197754, y: -3.1420390605926514 },
          { x: 10.32685661315918, y: -3.187108039855957 },
          { x: 9.97325611114502, y: -3.2612929344177246 },
          { x: 9.75689697265625, y: -3.3751869201660156 },
          { x: 9.572389602661133, y: -3.5404179096221924 },
          { x: 9.264613151550293, y: -3.955090045928955 },
          { x: 8.874327659606934, y: -4.324598789215088 },
          { x: 8.817244529724121, y: -4.458018779754639 },
          { x: 9.114574432373047, y: -6.537535190582275 },
          { x: 9.170517921447754, y: -6.760778903961182 },
          { x: 9.277105331420898, y: -6.9820427894592285 },
          { x: 9.433349609375, y: -7.172998905181885 },
          { x: 9.631685256958008, y: -7.321371078491211 },
          { x: 9.843742370605469, y: -7.412607192993164 },
          { x: 10.233124732971191, y: -7.452577114105225 }
        ]
      }
    },
    {
      type: 1, data: {
        hashId: 'channel1', points: [
          { x: 9.48228645324707, y: -5.158932685852051 },
          { x: 9.292285919189453, y: -5.078932762145996 },
          { x: 8.542285919189453, y: -4.748932838439941 },
          { x: 8.192286491394043, y: -4.548933029174805 },
          { x: 7.382286071777344, y: -3.898932933807373 },
          { x: 7.172286510467529, y: -3.71893310546875 }
        ]
      }
    },
  ];

  return (
    <View style={{ backgroundColor: '#fbeef0ff' }}>
      <Text>skiaDrawMapPage</Text>
      <MultiplePolygonsMapCanvas
        width={width}
        viewH={width}
        data={data}
        stripeAngleValue={60}
        activeTabIndex={activeTabIndex}
        onItemPress={(index) => {
          setActiveTabIndex(index);
        }}
      />
      <View style={{ flexDirection: 'row', justifyContent: 'space-around', marginTop: 20 }}>
        {data.map((item, index) => (
          <TouchableOpacity
            style={{
              width: 70, height: 30,
              backgroundColor: activeTabIndex === index ? '#4CAF50' : '#FF9800',
              borderRadius: 10,
              justifyContent: 'center',
              alignItems: 'center',
            }}
            onPress={() => {
              setActiveTabIndex(index)
            }}
          >
            <Text>{item.type === 0 ? (item.data as ZoneData).name : 'channel1'}</Text>
          </TouchableOpacity>
        ))}
      </View>
    </View>
  );
};

export default skiaDrawMapPage;